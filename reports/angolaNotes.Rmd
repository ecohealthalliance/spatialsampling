---
title: \vspace{8cm} \LARGE{Notes on the application of S3M for a nutrition survey in two provinces of Angola}
subtitle: ""
author: "Valid International"
date: '`r format(Sys.Date(), "%d %B %Y")`'
fontsize: 12pt
geometry: margin=2cm
documentclass: article
classoption: a4paper
bibliography: bibliography.bib
link-citations: TRUE
links-as-notes: FALSE
colorlinks: TRUE
linkcolor: blue
citecolor: blue
urlcolor: blue
lot: true
lof: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

knitr::knit_hooks$set(document = function(x) {
  sub('\\usepackage[]{color}', '\\usepackage{xcolor}', x, fixed = TRUE)
  }
)

if(!require(rgdal)) install.packages("rgdal")
if(!require(rgeos)) install.packages("rgeos")
if(!require(raster)) install.packages("raster")
if(!require(maps)) install.packages("maps")
if(!require(knitr)) install.packages("knitr")
if(!require(kableExtra)) install.packages("kableExtra")
if(!require(magrittr)) install.packages("magrittr")
if(!require(FNN)) install.packages("FNN")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(ggmap)) install.packages("ggmap")
if(!require(stringr)) install.packages("stringr")
if(!require(remotes)) install.packages("remotes")
if(!require(openxlsx)) install.packages("openxlsx")
if(!require(RColorBrewer)) install.packages("RColorBrewer")
if(!require(magrittr)) install.packages("magrittr")
if(!require(lubridate)) install.packages("lubridate")

if(!require(gadmr)) install_github("SpatialWorks/gadmr")
if(!require(spatialsampler)) install_github("SpatialWorks/spatialsampler")

if(!require(drlib)) install_github("dgrtwo/drlib")

themeSettings <- theme_bw() +
  theme(panel.border = element_rect(colour = "gray50",
                                    size = 0.5),
        panel.grid.major = element_line(linetype = 1,
                                        size = 0.1,
                                        colour = "gray90"),
        panel.grid.minor = element_line(linetype = 0),
        strip.background = element_rect(colour = "gray50",
                                        fill = "gray70"),
        strip.text = element_text(colour = "white", size = 16),
        legend.text = element_text(size = 16),
        legend.key = element_rect(linetype = 0),
        legend.key.size = unit(0.5, "cm"),
        legend.position = "top",
        axis.title = element_text(size = 16),
        axis.text.x = element_text(size = 14),
        axis.text.y = element_text(size = 14),
        axis.ticks = element_line(colour = "gray50", size = 0.5))

## Get map
ago1 <- gadmr::get_geopackage(country = "AGO", layer = 2)
ago2 <- gadmr::get_geopackage(country = "AGO", layer = 1)

subArea <- subset(ago1, NAME_1 %in% c("Cunene", "Huíla"))
cunene1 <- subset(ago1, NAME_1 == "Cunene")
cunene2 <- subset(ago2, NAME_1 == "Cunene")

if(!file.exists("maps/cuneneGrid.gpkg")) {
  cuneneSP <- spatialsampler::create_sp_grid(x = cunene1, d = 25, country = "Angola")
  cuneneGrid <- HexPoints2SpatialPolygons(hex = cuneneSP)
  cuneneGrid <- SpatialPolygonsDataFrame(Sr = cuneneGrid, 
                                         data = data.frame(id = 1:length(cuneneGrid)), 
                                         match.ID = FALSE)
  writeOGR(obj = cuneneGrid, dsn = "maps/cuneneGrid.gpkg", layer = "cunene", driver = "GPKG")
} else {
  cuneneGrid <- readOGR(dsn = "maps/cuneneGrid.gpkg", layer = "cunene")
}

huila1 <- subset(ago1, NAME_1 == "Huíla")
huila2 <- subset(ago2, NAME_1 == "Huíla")

if(!file.exists("maps/huilaGrid.gpkg")) {
  huilaSP <- spatialsampler::create_sp_grid(x = huila1, d = 25, country = "Angola")
  huilaGrid <- HexPoints2SpatialPolygons(hex = huilaSP)
  huilaGrid <- SpatialPolygonsDataFrame(Sr = huilaGrid, 
                                        data = data.frame(id = 1:length(huilaGrid)), 
                                        match.ID = FALSE)
  writeOGR(obj = huilaGrid, dsn = "maps/huilaGrid.gpkg", layer = "huila", driver = "GPKG")
} else {
  huilaGrid <- readOGR(dsn = "maps/huilaGrid.gpkg", layer = "huila")
}
```

\newpage

# Request

UNICEF Angola is planning to conduct a SMART survey in two provinces of Angola - Huíla and Cunene (see Figure \@ref(fig:angolaMap)). A request has been made to provide a possible alternative sampling plan based on a spatial sampling survey such as S3M. This plan will be shared with those supporting the Angola surveys and provide information for them to potentially consider other survey options.

```{r angolaMap, echo = FALSE, eval = TRUE, fig.cap = "Map of Angola showing Huíla and Cunene Provinces", fig.width = 10, fig.height = 10, fig.align = "center", fig.pos = "H"}
plot(subArea, lty = 0)
plot(ago1, add = TRUE)
plot(subArea, lwd = 3, add = TRUE)
text(coordinates(subArea), labels = subArea$NAME_1, cex = 3)

par(plt = c(0.01, 0.16, 0.84, 0.99), new = TRUE)

plot(ago1, col = ifelse(ago1$NAME_1 %in% c("Cunene", "Huíla"), "orange", NA))
polygon(x = c(bbox(subArea)[1,1] - 1, bbox(subArea)[1,1] - 1, 
              bbox(subArea)[1,2] + 1, bbox(subArea)[1,2] + 1), 
        y = c(bbox(subArea)[2,1] - 1, bbox(subArea)[2,2] + 1, 
              bbox(subArea)[2,2] + 1, bbox(subArea)[2,1] - 1), 
          border = "red", lwd = 3)
box(which = "plot", lty = "solid", lwd = 2)
```

# Considerations

Here, we consider the following assumptions or stated information requirements:

* UNICEF Angola needs estimates of undernutrition prevalence in each of the two provinces of Cunene and Huíla and will be doing a SMART survey in each province to report on results at province level;

* Other than undernutrition estimates, no other nutrition and related indicators will be assessed.

# Initial thoughts

* We think that for a country as big as Angola, a province-wide nutrition survey assumes homogeneity of undernutrition prevalence over a relatively big area. Cunene is $78,342 ~ km ^ 2$ while Huíla is $79,023 ~ km ^ 2$ .

* A method that can give an overall estimate for Cunene and Huíla but be able to provide results that show spatial variation of undernutrition prevalence within each province will provide more useful information.

* Measurement of a concise set of nutrition and nutrition-related indicators along with undernutrition information will be helpful.

# Alternatives

## RAM surveys in each of the municipalities in each of the two provinces

To be able to show spatial variation of undernutrition within each of the two provinces, we can consider a RAM survey in each of the municipalities of each of the two provinces. Cunene has 6 municipalities and Huíla has 13 municipalities. It is likely that interventions targeting undernutrition (e.g., CMAM, micronutrient powder and other supplementation programmes, etc.) are managed at the municipality level rather than at the province level.

This would mean doing 19 RAM surveys (6 in Cunene and 13 in Huíla). One RAM survey will require a sample of 192 children 6-59 months old. So, for 19 RAMs, a total sample size of 3648.

Compared to a province-level SMART which would probably have anywhere between 600-900 sample size per province for a total of about 1200 to 1800 sample size for two provinces, the RAM surveys will be between 2-3 times the sample size but will provide per municipality results plus province level totals. For the amount of relatively detailed information on where undernutrition is a problem in the two provinces, the increase in cost we think is acceptable.

## S3M survey in each of the two provinces

Another alternative approach will be to conduct a Simple Spatial Survey Method (S3M) in each of the provinces. The S3M will be able to provide an overall estimate of undernutrition prevalences for each province but also provide a map of each province showing the spatial distribution of undernutrition.

Setting a maximum distance of 25 kms from a sampling point as our assumed area of homogeneity[^1], we create a hexagonal grid across each of the provinces with a size of about $2338 ~ km ^ 2$  (see Figure \@ref(fig:cuneneGrid) and Figure \@ref(fig:huilaGrid)).

```{r cuneneGrid, echo = FALSE, eval = TRUE, fig.cap = "Hexagonal sampling grid for Cunene Province", fig.width = 10, fig.height = 10, fig.align = "center", fig.pos = "H"}
plot(cunene2)
plot(ago1, lwd = 3, add = TRUE)
plot(cunene1, lwd = 4, border = "darkgreen", add = TRUE)
plot(cuneneGrid, lwd = 3, border = "darkblue", add = TRUE)
points(coordinates(cuneneGrid), pch = 20, col = "red", cex = 2)
```

```{r huilaGrid, echo = FALSE, eval = TRUE, fig.cap = "Hexagonal sampling grid for Huila Province", fig.width = 10, fig.height = 10, fig.align = "center", fig.pos = "H"}
plot(huila2)
plot(ago1, lwd = 3, add = TRUE)
plot(huila1, lwd = 4, border = "darkgreen", add = TRUE)
plot(huilaGrid, lwd = 3, border = "darkblue", add = TRUE)
points(coordinates(huilaGrid), pch = 20, col = "red", cex = 2)
```

The S3M sampling grid provides about 56 sampling points for each of the provinces. The typical sampling plan for an S3M is to select on cluster/village per sampling point and then we typically select up to 32 samples per village. This gives a total sample size of 1792 per province for a total of 3584 sample size for both provinces.

Compared to a province-level SMART which would probably have anywhere between 600-900 sample size per province for a total of about 1200 to 1800 sample size for two provinces, the S3M surveys will be between 2-3 times the sample size but will provide a map of spatial distribution of undernutrition in each province and an overall estimate for each province. For the amount of relatively detailed information on where undernutrition is a problem in the two provinces, the increase in cost we think is acceptable.


[^1]: This area size is still relatively big and smaller sizes can be specified depending on the budget and resources available. But relative to the homogeneity assumption made by the SMART survey for the whole province, this is a relatively more realistic assumption of homogeneity.




